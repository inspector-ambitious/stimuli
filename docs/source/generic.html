<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">'use strict';

(function() {

    var ns = Stimuli.command.mouse;


    ns.Generic = {
        
        ctor: function(options) {

            this.options = {};
            
            Stimuli.utils.Object.merge(this.options, options);

        },

        proto: {

            getBoundingRectangle: function(element) {
                return new ns.BoundingRectangle(this.viewport, element);
            },

            getBoundingRectangleOffset: function(offset, boundingRectangle) {
                return new ns.boundingRectangleOffset(offset, boundingRectangle);
            },

            getPosition: function(target, offset) {
                var me = this,
                    boundingRectangle,
                    boundingRectangleOffset,
                    position;
                
                if (!target) {
                    me.fail('Invalid target: not found.');
                    return null;
                }

                boundingRectangle = me.getBoundingRectangle(target);

                if (!boundingRectangle.isValid()) {
                    me.fail('Invalid target: found but not visible in the viewport.');
                    return null;
                }

                offset = offset || boundingRectangle.getTargetEdge();
        
                boundingRectangleOffset = me.getBoundingRectangleOffset(offset, boundingRectangle.getXLimit(), boundingRectangle.getYLimit());

                position = new ns.Position(this.viewport, target, boundingRectangle, boundingRectangleOffset);

                if (!position.isValid()) {
                    me.fail('Invalid offset: outside target.');
                    return null;
                }

                return position;
            },

            getButton: function() {
                
                var isModern = Stimuli.browser.Support.isModern,
                    buttonsMap = {
                    left: isModern ? 0 : 1,
                    middle: isModern ? 1 : 4,
                    right: 2,
                    none: undefined
                };

                return buttonsMap[this.options.button || 'left']; // Default left button
            }

        }
    };

})();
</pre>
</body>
</html>
